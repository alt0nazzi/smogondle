<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8">
  <title>Smogondle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
    async function updateSuggestions(value) {
      const res = await fetch(`/autocomplete?q=${value}`);
      const names = await res.json();
      const datalist = document.getElementById("pokemon-list");
      datalist.innerHTML = "";
      names.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        datalist.appendChild(option);
      });
    }
  </script>
  <style>
    @keyframes pop-in {0% {opacity: 0; transform: scale(0.8) translateY(10px);} 100% {opacity: 1; transform: scale(1) translateY(0);}}

    @keyframes bounce-flip {0% {transform: rotateY(0deg) scale(1);} 50% {transform: rotateY(90deg) scale(1.2);} 100% {transform: rotateY(180deg) scale(1);}}

    @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

    @keyframes shake {
          0% { transform: translateX(0); }
          25% { transform: translateX(-4px); }
          50% { transform: translateX(4px); }
          75% { transform: translateX(-4px); }
          100% { transform: translateX(0); }
        }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    @keyframes fade-in {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .animate-fade-in {
      animation: fade-in 0.5s forwards;
    }

    .animate-pop {
      animation: pop 0.4s ease;
    }

    .animate-shake {
      animation: shake 0.4s ease;
    }
    .animate-fade-in {
      animation: fade-in 0.4s ease-out forwards;
    }
    .type-icon {
      height: 32px;
      width: 32px;
      border-radius: 9999px;
      margin-right: 8px;
      border: 2px solid #555;
      background: #1f2937;
    }
    .perspective {
      perspective: 1000px;
    }
    .flip-card-inner {
      animation: bounce-flip 0.8s ease-out forwards;
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.8s;
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 0.75rem;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }

    @keyframes busy-drift {
      0% {
        transform: translate(0px, 0px) scale(1) rotate(0deg);
        opacity: 0.12;
      }
      25% {
        transform: translate(30px, 20px) scale(1.03) rotate(0.5deg);
        opacity: 0.14;
      }
      50% {
        transform: translate(-20px, 30px) scale(1.05) rotate(-0.5deg);
        opacity: 0.16;
      }
      75% {
        transform: translate(25px, -20px) scale(1.02) rotate(0.3deg);
        opacity: 0.13;
      }
      100% {
        transform: translate(0px, 0px) scale(1) rotate(0deg);
        opacity: 0.12;
      }
    }
    .animate-busy-drift {
      animation: busy-drift 60s ease-in-out infinite;
    }

    @keyframes fall {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.5; /* start more subtle */
      }
      100% {
        transform: translateY(100vh) translateX(30px);
        opacity: 0; /* fade to invisible */
      }
    }

    @keyframes fall-slow {
      0% { transform: translateY(0) translateX(0); opacity: 0.4; }
      100% { transform: translateY(100vh) translateX(30px); opacity: 0; }
    }

    @keyframes fall-fast {
      0% { transform: translateY(0) translateX(0); opacity: 0.8; }
      100% { transform: translateY(100vh) translateX(80px); opacity: 0; }
    }

    @keyframes supernova-flash {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
      100% {
        transform: scale(1.8);
        opacity: 0;
      }
    }

    @keyframes fly-across {
      0% {
        transform: translateX(-100px) translateY(0) rotate(0deg) scale(1);
        opacity: 0;
      }
      10% {
        opacity: 0.8;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        transform: translateX(110vw) translateY(-30px) rotate(5deg) scale(1.1);
        opacity: 0;
      }
    }

    @keyframes sparkle {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .flying-star {
      position: absolute;
      top: 20%;
      left: -100px;
      width: 80px;
      height: 80px;
      background: url('/static/star.png') no-repeat center center;
      background-size: contain;
      opacity: 0;
      animation: fly-across 15s linear forwards, sparkle 1.5s ease-in-out infinite;
      pointer-events: none;
      z-index: -4;
    }

    /* Regular faint star */
    .falling-star {
      position: absolute;
      top: 0;
      width: 1px;
      height: 60px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.6), transparent);
      animation: fall-slow 5s linear forwards;
      opacity: 0.4;
      pointer-events: none;
      z-index: -5;
    }

    /* Rare bright star */
    .bright-star {
      position: absolute;
      top: 0;
      width: 2px;
      height: 90px;
      background: linear-gradient(to bottom, rgba(255,255,255,1), transparent);
      animation: fall-fast 3s linear forwards;
      opacity: 0.8;
      pointer-events: none;
      z-index: -5;
    }

    .falling-star {
      position: absolute;
      top: 0; /* Always start at top! */
      width: 1px;
      height: 60px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.6), transparent);
      opacity: 0.4; /* overall more subtle */
      animation: fall 3s linear forwards;
      pointer-events: none;
      z-index: -5;
    }

    @keyframes score-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .animate-score-pop {
      animation: score-pop 0.5s ease;
      }

      @keyframes float-up {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-40px);
      opacity: 0;
    }
  }

  .floating-points {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.5rem;
    font-weight: bold;
    color: #7dd3fc; /* light cyan */
    text-shadow: 0 0 8px #7dd3fc;
    animation: float-up 1.5s ease-out forwards;
    pointer-events: none;
    z-index: 20;
  }

  @keyframes slide-fade-up {
    0% {
      transform: translateY(50px);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-slide-fade-up {
    animation: slide-fade-up 0.5s ease-out forwards;
  }

  @keyframes click-pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  .animate-click-pop {
    animation: click-pop 0.3s ease;
  }

  body {
    background: url('/static/background-nebula.jpg') no-repeat center center;
    background-size: cover;
    background-attachment: fixed;
    background-color: #030712; /* Deep cosmic fallback */
    overflow-x: hidden;
  }

  .page-fade {
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
  }

  .page-fade.loaded {
    opacity: 1;
  }

  #cinematics-layer {
    background: url('/static/nebula.png') no-repeat center center;
    background-size: cover;
    background-attachment: fixed;
    animation: busy-drift 60s ease-in-out infinite;
    z-index: 0;
  }

  </style>
</head>
<body class="{% if fade_in %}page-fade{% endif %}">
  <div class="min-h-screen flex flex-col justify-center items-center px-4">
    <div id="cinematics-layer" class="absolute inset-0 pointer-events-none z-0"></div>
    <div class="bg-gray-800 shadow-2xl rounded-2xl p-8 w-full max-w-2xl relative z-10">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-center text-4xl font-extrabold text-indigo-400 mb-6 tracking-wide">
          {% if intro_animation %}
            {% for letter in "Smogondle" -%}
              <span class="inline-block opacity-0 animate-fade-in" style="animation-delay: {{ loop.index0 * 0.1 }}s;">{{ letter }}</span>{%- endfor %}
          {% else %}
            Smogondle
          {% endif %}
        </h1>                 
        <p class="text-center text-sm text-gray-400 italic">Guess the Pokémon from Smogon forum hints!</p>       
      </div>

      <div class="flex justify-center mb-6">
        <button onclick="toggleFilters()" class="px-6 py-2 bg-gradient-to-r from-purple-700 to-indigo-600 text-white rounded-lg hover:brightness-110 transition duration-300">
          Filters
        </button>
      </div>      

      <form method="POST" action="/guess" class="flex gap-2 mb-6">
        <div class="relative flex-1">
          <input
            type="text"
            name="guess"
            id="guess-input"
            list="pokemon-list"
            placeholder="Enter Pokémon..."
            oninput="updateSuggestions(this.value)"
            required
            autocomplete="off"
            class="peer w-full px-4 py-3 pt-5 rounded-xl bg-gray-700 text-white placeholder-transparent border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200 {% if guess_wrong %}animate-shake{% endif %}"
          >
          <label
            for="guess-input"
            class="absolute left-4 top-3 text-gray-400 text-sm transition-all peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-focus:top-3 peer-focus:text-sm peer-focus:text-indigo-400"
          >
            Enter Pokémon...
          </label>
          <datalist id="pokemon-list"></datalist>
        </div>      
        <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700">Guess</button>
        {% if hint_index >= (hints|length - 1) and not image_revealed %}
        <a href="/giveup" class="px-6 py-3 bg-gray-600 text-white rounded-xl hover:bg-gray-700 ml-2">Give up?</a>
        {% endif %}
      </form>

      <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">Hints:</h2>
        <ul class="space-y-3">
          {% for hint in hints %}
          {% set delay = loop.index0 * 0.1 %}
            <li class="bg-gray-700 p-3 rounded-lg flex flex-col animate-fade-in" style="animation-delay: {{ delay }}s">
              <strong class="mb-2">{{ hint.label }}:</strong>
              {% if hint.types %}
              <div class="flex flex-wrap">
                {% for type in hint.types %}
                <div class="relative group inline-block">
                  <img src="{{ type.url }}" alt="{{ type.name }} Icon" class="h-8 w-8">
                  <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 rounded bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                    {{ type.name }}
                  </div>
                </div>              
                {% endfor %}
              </div>
            {% elif hint.html %}
              <div class="p-3 rounded-md text-sm animate-pop-in hover-glow {{ hint.tier_class }}" style="line-height: 1.5;">
                {{ hint.html|safe }}
              </div>
            {% elif hint.text %}
              <span>{{ hint.text|safe }}</span>
            {% endif %}          
            </li>
          {% endfor %}
        </ul>
      </div>

      <div class="flex flex-col items-center mt-8 space-y-2">
        <div id="floating-points-container" class="relative h-0"></div>
        <div class="text-3xl font-bold text-cyan-300 drop-shadow-lg {% if last_correct %}animate-score-pop{% endif %}">
          Score: {{ score }}
        </div>      
        <div class="text-xl font-semibold text-blue-200">
          Rounds: {{ rounds }}
        </div>
        <div class="mt-6">
          <button onclick="toggleSettings()" class="text-blue-300 hover:text-cyan-400 transition duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l.518 1.594a1 1 0 00.95.69h1.664c.969 0 1.371 1.24.588 1.81l-1.347.978a1 1 0 000 1.64l1.347.978c.783.57.38 1.81-.588 1.81h-1.664a1 1 0 00-.95.69l-.518 1.594c-.3.921-1.603.921-1.902 0l-.518-1.594a1 1 0 00-.95-.69H8.405c-.969 0-1.371-1.24-.588-1.81l1.347-.978a1 1 0 000-1.64l-1.347-.978c-.783-.57-.38-1.81.588-1.81h1.664a1 1 0 00.95-.69l.518-1.594z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
      </div>    

      {% if image_revealed %}
      <div class="text-center mb-6">
        <h3 class="text-green-400 text-2xl font-bold mb-2">Correct!</h3>
        {% if bonus_multiplier %}
        <div class="text-indigo-400 font-bold text-md mt-1 animate-bounce">x1.5 Bonus!</div>
        {% endif %}
        <div class="relative w-40 h-40 mx-auto perspective mb-4">
          <div class="flip-card-inner">
            <div class="flip-card-front bg-gray-600 rounded-xl shadow"></div>
            <div class="flip-card-back bg-gray-200 rounded-xl shadow flex items-center justify-center">
              <img src="{{ image_url }}" alt="Pokemon Sprite" class="w-28 h-28 object-contain">
            </div>
          </div>
        </div>
        <div class="flex justify-center gap-4">
          <a href="/next" id="next-button" class="px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700">Next Pokémon</a>
          <a href="/reset" class="px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700">Start Over</a>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 40 },
        color: { value: "#888" },
        shape: { type: "circle" },
        opacity: { value: 0.3 },
        size: { value: 3 },
        move: { enable: true, speed: 0.5 }
      },
      interactivity: { detect_on: "canvas", events: { onhover: { enable: false } } },
      retina_detect: true
    });
  </script>
  <script>
    function clearGuessBox() {
      const guessInput = document.getElementById('guess-input');
      if (guessInput) {
        guessInput.value = '';
      }
    }
  
    {% if image_revealed and last_correct %}
    // If the guess was correct, clear the input box
    window.addEventListener('load', function() {
      clearGuessBox();
    });
    {% endif %}
  </script>
<script>
  function createFallingStar() {
    const isBright = Math.random() < 0.05; // 5% chance = ~1 in 20 stars
    const star = document.createElement("div");
  
    if (isBright) {
      star.classList.add("bright-star");
    } else {
      star.classList.add("falling-star");
    }
  
    // Random horizontal position
    const left = Math.random() * window.innerWidth;
    star.style.left = `${left}px`;
  
    // Slight random animation delay (for variation)
    const delay = Math.random() * 0.5;
    star.style.animationDelay = `${delay}s`;
  
    // Append and remove after animation
    document.getElementById('cinematics-layer').appendChild(star);
    setTimeout(() => {
      star.remove();
    }, isBright ? 3500 : 5500); // bright stars are faster, so remove earlier
  }
  
  setInterval(() => {
    if (!cinematicsEnabled) return; // If cinematics off, skip all visual events

    const random = Math.random();

    if (random < 0.05) { 
      createSupernova();
    } else if (random < 0.5) { 
      createFallingStar();
    }

    if (Math.random() < 0.1) {
      createFlyingStar();
    }
  }, 6000);

  function createSupernova() {
    const supernova = document.createElement("div");
    supernova.style.position = "absolute";
    supernova.style.top = `${Math.random() * window.innerHeight}px`;
    supernova.style.left = `${Math.random() * window.innerWidth}px`;
    supernova.style.width = "100px";
    supernova.style.height = "100px";
    supernova.style.borderRadius = "50%";
    supernova.style.background = "radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%)";
    supernova.style.opacity = "0";
    supernova.style.zIndex = "-3";
    supernova.style.pointerEvents = "none";
    supernova.style.animation = "supernova-flash 1.5s ease-out forwards";
    
    document.getElementById('cinematics-layer').appendChild(supernova);

    setTimeout(() => {
      supernova.remove();
    }, 1600);
  }
  function createFlyingStar() {
    const flyingStar = document.createElement("div");
    flyingStar.classList.add("flying-star");

    // Random vertical starting position (10% to 60%)
    const randomTop = 10 + Math.random() * 50;
    flyingStar.style.top = `${randomTop}%`;

    // Random small flight tilt
    const randomAngle = (Math.random() - 0.5) * 20; // -10deg to +10deg
    flyingStar.style.transform = `rotate(${randomAngle}deg)`;

    document.getElementById('cinematics-layer').appendChild(flyingStar);

    setTimeout(() => {
      flyingStar.remove();
    }, 16000); // a bit longer than the animation
  }
  </script>
<script>
  function showFloatingPoints(points, isPerfect) {
    const container = document.getElementById('floating-points-container');
  
    // Floating points
    const floatText = document.createElement('div');
    floatText.className = 'floating-points';
    floatText.innerText = `+${points}`;
  
    // Dynamic color based on hint index
    {% if hint_index == 0 %}
      floatText.style.color = '#facc15'; // Gold for perfect
      floatText.style.textShadow = '0 0 8px #facc15';
    {% elif hint_index <= 2 %}
      floatText.style.color = '#7dd3fc'; // Light blue for good guesses
      floatText.style.textShadow = '0 0 8px #7dd3fc';
    {% else %}
      floatText.style.color = '#9ca3af'; // Gray for late guesses
      floatText.style.textShadow = '0 0 8px #9ca3af';
    {% endif %}
  
    container.appendChild(floatText);
  
    // If it's a perfect guess, show a "Perfect!" text too
    if (isPerfect) {
      const perfectText = document.createElement('div');
      perfectText.className = 'floating-points';
      perfectText.style.color = '#facc15'; // Gold glow
      perfectText.style.textShadow = '0 0 10px #facc15';
      perfectText.style.fontSize = '1.8rem';
      perfectText.style.fontWeight = 'bold';
      perfectText.style.marginTop = '30px';
      perfectText.innerText = 'Perfect!';
      container.appendChild(perfectText);
  
      setTimeout(() => {
        perfectText.remove();
      }, 1600);
    }
  
    setTimeout(() => {
      floatText.remove();
    }, 1600);
  }
</script>
{% if points_earned %}
<script>
  window.addEventListener('load', () => {
    showFloatingPoints({{ points_earned }}, {{ 'true' if hint_index == 0 else 'false' }});
  });
</script>
{% endif %}
<!-- Settings Modal -->
<div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
  <div id="settings-card" class="bg-indigo-900 rounded-lg p-8 space-y-6 w-80 shadow-2xl opacity-0">
    <h2 class="text-2xl font-bold text-cyan-300 text-center mb-4">Settings</h2>

    <!-- Future settings toggles -->
    <!-- Music Toggle -->
    <div class="flex items-center justify-between">
      <span class="text-blue-200">Music</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input id="music-toggle" type="checkbox" class="sr-only peer">
        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-cyan-400 transition-colors duration-300 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
      </label>
    </div>

    <!-- Cinematics Toggle -->
    <div class="flex items-center justify-between">
      <span class="text-blue-200">Cinematics</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input id="cinematics-toggle" type="checkbox" class="sr-only peer">
        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-cyan-400 transition-colors duration-300 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
      </label>
    </div>

    <!-- Restart Button moved here -->
    <form action="{{ url_for('restart') }}" method="post" class="flex justify-center">
      <button type="submit" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-blue-500 text-white rounded-xl hover:brightness-110 transition duration-300">
        Restart Smogondle
      </button>
    </form>

    <div class="flex justify-center">
      <button onclick="toggleSettings()" class="mt-4 text-blue-300 hover:text-cyan-400">
        Close
      </button>
    </div>
  </div>
</div>
<!-- Filters Modal -->
<div id="filters-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
  <div id="filters-card" class="bg-indigo-900 rounded-lg p-8 space-y-6 w-80 shadow-2xl opacity-0">
    <h2 class="text-2xl font-bold text-cyan-300 text-center mb-4">Filters</h2>

    <!-- Tiers form inside Filters modal -->
    <form method="POST" action="/update_tiers" id="filters-form" class="flex flex-wrap gap-2 justify-center">
      {% for tier in tiers %}
        <label class="tier-button relative flex items-center justify-center px-4 py-2 rounded-lg cursor-pointer transition duration-300 bg-indigo-800 border-2 border-transparent hover:brightness-110 peer-checked:border-cyan-400 peer-checked:bg-cyan-700 peer-checked:scale-105 peer-checked:text-white">
          <input type="checkbox" name="tiers" value="{{ tier }}" class="sr-only peer" {% if tier in selected_tiers %}checked{% endif %}>
          <span class="text-blue-200 peer-checked:text-white font-semibold">{{ tier }}</span>
        </label>
      {% endfor %}
      <div class="w-full flex justify-center mt-6">
        <button type="submit" class="px-6 py-2 bg-gradient-to-r from-purple-700 to-indigo-600 text-white rounded-xl hover:brightness-110 transition duration-300">
          Apply Filters
        </button>
      </div>
    </form>

    <div class="flex justify-center">
      <button onclick="toggleFilters()" class="mt-4 text-blue-300 hover:text-cyan-400">
        Close
      </button>
    </div>
  </div>
</div>
<script>
  function toggleSettings() {
    const modal = document.getElementById('settings-modal');
    const card = document.getElementById('settings-card');
  
    if (modal.classList.contains('hidden')) {
      modal.classList.remove('hidden');
      card.classList.add('animate-slide-fade-up');
    } else {
      modal.classList.add('hidden');
      card.classList.remove('animate-slide-fade-up');
      card.style.opacity = "0"; // Reset opacity for next open
    }
  }
</script>
<script>
  function toggleFilters() {
    const modal = document.getElementById('filters-modal');
    const card = document.getElementById('filters-card');
  
    if (modal.classList.contains('hidden')) {
      modal.classList.remove('hidden');
      card.classList.add('animate-slide-fade-up');
    } else {
      modal.classList.add('hidden');
      card.classList.remove('animate-slide-fade-up');
      card.style.opacity = "0"; // Reset opacity for next open
    }
  }
</script>  
<script>
  let cinematicsEnabled = true;
  // Save toggle changes to localStorage
  function saveToggleStates() {
    const musicToggle = document.getElementById('music-toggle').checked;
    const cinematicsToggle = document.getElementById('cinematics-toggle').checked;
  
    localStorage.setItem('musicEnabled', musicToggle);
    localStorage.setItem('cinematicsEnabled', cinematicsToggle);
  }
  
  // Load saved toggle states on page load
  function loadToggleStates() {
    const musicState = localStorage.getItem('musicEnabled');
    const cinematicsState = localStorage.getItem('cinematicsEnabled');

    // Music: default OFF
    if (musicState === null) {
      document.getElementById('music-toggle').checked = false;
      localStorage.setItem('musicEnabled', false);
    } else {
      document.getElementById('music-toggle').checked = (musicState === 'true');
    }

    // Cinematics: default ON
    if (cinematicsState === null) {
      document.getElementById('cinematics-toggle').checked = true;
      localStorage.setItem('cinematicsEnabled', true);
    } else {
      document.getElementById('cinematics-toggle').checked = (cinematicsState === 'true');
    }

    // Update cinematicsEnabled JS flag
    cinematicsEnabled = (localStorage.getItem('cinematicsEnabled') === 'true');
  }
  
  // Auto-save when user clicks toggle
  document.addEventListener('DOMContentLoaded', () => {
    loadToggleStates();
  
    document.getElementById('music-toggle').addEventListener('change', saveToggleStates);
    document.getElementById('cinematics-toggle').addEventListener('change', saveToggleStates);
  });
</script>
<script>
  document.querySelectorAll('input[name="tiers"]').forEach(tierCheckbox => {
    tierCheckbox.addEventListener('change', (e) => {
      const label = e.target.closest('label');
      label.classList.add('animate-click-pop');
      setTimeout(() => {
        label.classList.remove('animate-click-pop');
      }, 300); // match animation duration
    });
  });
</script>
<script>
  document.querySelectorAll('.tier-button').forEach(label => {
    label.addEventListener('click', (e) => {
      const checkbox = label.querySelector('input[type="checkbox"]');
      if (checkbox) {
        checkbox.checked = !checkbox.checked; // Toggle manually

        // Animate pop
        label.classList.add('animate-click-pop');
        setTimeout(() => {
          label.classList.remove('animate-click-pop');
        }, 300); // match animation duration

        // Do NOT submit form here anymore
      }
    });
  });
</script>
<script>
  window.addEventListener('load', () => {
    document.body.classList.add('loaded');
  });
</script>
<script>
  window.addEventListener('scroll', function() {
    document.body.style.backgroundPositionY = -(window.scrollY * 0.2) + 'px';
  });
</script>
<script>
  window.addEventListener('load', () => {
    const guessInput = document.getElementById('guess-input');
    if (guessInput) {
      guessInput.focus();
    }
  });
  
  // Optional: Re-focus if user clicks submit (in case of wrong guess and page doesn't reload)
  const guessForm = document.querySelector('form[action="/guess"]');
  if (guessForm) {
    guessForm.addEventListener('submit', function(event) {
      setTimeout(() => {
        const guessInput = document.getElementById('guess-input');
        if (guessInput) {
          guessInput.focus();
        }
      }, 100); // slight delay to ensure the DOM updates first
    });
  }
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const guessInput = document.getElementById('guess-input');
    const guessForm = document.querySelector('form[action="/guess"]');
    
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        const nextButton = document.getElementById('next-button');
  
        if (nextButton && nextButton.offsetParent !== null) {
          // If next button is visible, trigger it
          event.preventDefault();
          nextButton.click();
        } else {
          // Otherwise normal guess submit
          if (document.activeElement === guessInput) {
            // Let form submit naturally
          } else {
            event.preventDefault();
            if (guessInput) {
              guessInput.focus();
            }
          }
        }
      }
    });
  });
</script>  
<audio id="background-music" loop autoplay hidden>
  <source src="/static/background-music.mp3" type="audio/mpeg">
</audio>
</body>
</html>
